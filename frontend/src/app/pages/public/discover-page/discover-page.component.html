<div class="min-h-screen bg-gray-50 dark:bg-gray-950 pt-16">

    <!-- ═══════════════════════════════════════════════
         HERO HEADER
    ═══════════════════════════════════════════════ -->
    <div class="relative bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 overflow-hidden">
        <div class="absolute inset-0 pointer-events-none">
            <div class="absolute top-0 left-1/4 w-96 h-96 bg-brand-400/5 dark:bg-brand-500/5 rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-purple-400/5 dark:bg-purple-500/5 rounded-full blur-3xl"></div>
        </div>

        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">

            <!-- Breadcrumb -->
            <div class="flex items-center gap-2 text-sm text-gray-400 dark:text-gray-500 mb-6">
                <a routerLink="/" class="hover:text-brand-600 dark:hover:text-brand-400 transition-colors font-medium">Home</a>
                <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                </svg>
                <span class="text-gray-700 dark:text-gray-300 font-semibold">Explore Stores</span>
            </div>

            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8">
                <div class="max-w-2xl">
                    <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-brand-50 dark:bg-brand-900/30 border border-brand-200 dark:border-brand-800 rounded-full mb-5">
                        <span class="w-1.5 h-1.5 rounded-full bg-brand-500 animate-pulse"></span>
                        <span class="text-xs font-semibold text-brand-700 dark:text-brand-300 tracking-wide">Live stores · Updated daily</span>
                    </div>
                    <h1 class="text-4xl sm:text-5xl font-bold text-gray-900 dark:text-white leading-tight mb-3">
                        Discover what's<br>
                        <span class="inline-flex items-center gap-1" style="height:1.2em; min-width:8rem;">
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-500 to-purple-500 whitespace-nowrap">{{ typedText }}&nbsp;</span>
                            <span class="inline-block w-0.5 flex-shrink-0 bg-gradient-to-b from-brand-500 to-purple-500 rounded-full"
                                  style="height:0.9em;"
                                  [style.opacity]="cursorVisible ? '1' : '0'"></span>
                        </span>
                    </h1>
                    <p class="text-base text-gray-500 dark:text-gray-400 leading-relaxed">
                        Browse curated products from our verified stores — no account needed.
                    </p>
                </div>

                <!-- Stats -->
                <div class="flex items-center gap-6 flex-shrink-0">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">
                            <ng-container *ngIf="!isInitialLoading">{{ total }}</ng-container>
                            <span *ngIf="isInitialLoading" class="inline-block w-8 h-7 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"></span>
                        </p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Total stores</p>
                    </div>
                    <div class="w-px h-10 bg-gray-200 dark:bg-gray-700"></div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">12k+</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Products</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════
         CONTENU
    ═══════════════════════════════════════════════ -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

        <!-- ── AUTH LOADING ───────────────────────────── -->
        <div *ngIf="isAuthLoading" class="space-y-6">
            <div *ngFor="let s of skeletonItems"
                 class="bg-white dark:bg-gray-900 rounded-3xl border border-gray-200 dark:border-gray-800 overflow-hidden">
                <div class="p-6 flex items-center justify-between gap-4 border-b border-gray-100 dark:border-gray-800">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-2xl bg-gray-200 dark:bg-gray-700 animate-pulse flex-shrink-0"></div>
                        <div class="space-y-2.5">
                            <div class="h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                            <div class="h-3 w-20 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                        </div>
                    </div>
                    <div class="h-10 w-28 bg-gray-200 dark:bg-gray-700 rounded-xl animate-pulse flex-shrink-0"></div>
                </div>
                <div class="p-6 grid grid-cols-2 gap-4">
                    <div *ngFor="let p of [1,2]" class="rounded-2xl overflow-hidden bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700">
                        <div class="aspect-[4/3] bg-gray-200 dark:bg-gray-700 animate-pulse"></div>
                        <div class="p-3 space-y-2">
                            <div class="h-3 w-3/4 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                            <div class="h-3 w-1/2 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ── ERREUR ──────────────────────────────────── -->
        <div *ngIf="!isAuthLoading && hasError && !isInitialLoading"
             class="flex flex-col items-center justify-center py-24 text-center">
            <div class="w-16 h-16 rounded-2xl bg-red-50 dark:bg-red-900/20 flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Something went wrong</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">We couldn't load the stores. Please try again.</p>
            <button (click)="loadStores()"
                    class="inline-flex items-center gap-2 px-6 py-3 bg-brand-500 hover:bg-brand-600 text-white text-sm font-semibold rounded-xl transition-colors">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                Try again
            </button>
        </div>

        <!-- ── VIDE ────────────────────────────────────── -->
        <div *ngIf="!isAuthLoading && !isInitialLoading && !hasError && stores.length === 0"
             class="flex flex-col items-center justify-center py-24 text-center">
            <div class="w-16 h-16 rounded-2xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">No stores yet</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">Check back soon — new stores are joining every day.</p>
        </div>

        <!-- ── SKELETONS ───────────────────────────────── -->
        <div *ngIf="!isAuthLoading && isInitialLoading" class="space-y-6">
            <div *ngFor="let s of skeletonItems"
                 class="bg-white dark:bg-gray-900 rounded-3xl border border-gray-200 dark:border-gray-800 overflow-hidden">
                <div class="p-6 flex items-center justify-between gap-4 border-b border-gray-100 dark:border-gray-800">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-2xl bg-gray-200 dark:bg-gray-700 animate-pulse flex-shrink-0"></div>
                        <div class="space-y-2.5">
                            <div class="h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                            <div class="h-3 w-20 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                            <div class="h-3 w-56 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                        </div>
                    </div>
                    <div class="h-10 w-28 bg-gray-200 dark:bg-gray-700 rounded-xl animate-pulse flex-shrink-0"></div>
                </div>
                <div class="p-6 grid grid-cols-2 gap-4">
                    <div *ngFor="let p of [1,2]" class="rounded-2xl overflow-hidden bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700">
                        <div class="aspect-[4/3] bg-gray-200 dark:bg-gray-700 animate-pulse"></div>
                        <div class="p-3 space-y-2">
                            <div class="h-3 w-3/4 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                            <div class="h-3 w-1/2 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ── STORES ──────────────────────────────────── -->
        <div *ngIf="!isAuthLoading && !isInitialLoading && !hasError && stores.length > 0" class="space-y-6">

            <div *ngFor="let store of stores"
                 class="group bg-white dark:bg-gray-900 rounded-3xl border border-gray-200 dark:border-gray-800 overflow-hidden hover:border-gray-300 dark:hover:border-gray-700 hover:shadow-2xl hover:shadow-gray-100/80 dark:hover:shadow-gray-950/80 transition-all duration-500">

                <!-- ── Store Header ─────────────────────── -->
                <div class="relative p-5 sm:p-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">

                    <!-- Barre accent gauche -->
                    <div class="absolute left-0 top-4 bottom-4 w-0.5 bg-gradient-to-b from-brand-400 to-purple-500 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-500"></div>

                    <div class="flex items-center gap-4 min-w-0">

                        <!-- Logo avec ring au hover -->
                        <div class="relative flex-shrink-0">
                            <div class="w-14 h-14 rounded-2xl overflow-hidden border-2 border-gray-100 dark:border-gray-800 shadow-sm group-hover:border-brand-200 dark:group-hover:border-brand-800 transition-colors duration-300 bg-gray-50 dark:bg-gray-800">
                                <img [src]="store.boutique.logo" [alt]="store.boutique.name"
                                     class="w-full h-full object-cover"/>
                            </div>
                            <!-- Point vert "actif" -->
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-emerald-400 border-2 border-white dark:border-gray-900 shadow-sm"></div>
                        </div>

                        <!-- Infos boutique -->
                        <div class="min-w-0">
                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                <h2 class="text-base font-bold text-gray-900 dark:text-white truncate">{{ store.boutique.name }}</h2>
                                <!-- Badge vérifié -->
                                <svg class="w-4 h-4 text-brand-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <!-- Type badge -->
                                <span *ngIf="store.boutique.isLocal"
                                      class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400 border border-brand-100 dark:border-brand-800">
                                    <span class="w-1.5 h-1.5 rounded-full bg-brand-500"></span>
                                    In Center
                                </span>
                                <span *ngIf="!store.boutique.isLocal"
                                      class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-violet-50 dark:bg-violet-900/20 text-violet-700 dark:text-violet-400 border border-violet-100 dark:border-violet-800">
                                    <span class="w-1.5 h-1.5 rounded-full bg-violet-500"></span>
                                    External
                                </span>
                            </div>
                            <p class="text-sm text-gray-400 dark:text-gray-500 truncate max-w-sm">{{ store.boutique.description }}</p>
                        </div>
                    </div>

                    <!-- CTA boutique -->
                    <!-- User connecté → lien direct -->
                    <a *ngIf="currentUser?.role === 'user'"
                       [routerLink]="getStoreRoute(store.boutique._id)"
                       class="flex-shrink-0 self-start sm:self-auto inline-flex items-center gap-2 px-4 py-2.5 text-sm font-bold rounded-xl border-2 border-gray-900 dark:border-gray-600 text-gray-900 dark:text-white hover:bg-gray-900 hover:text-white dark:hover:bg-white dark:hover:text-gray-900 dark:hover:border-white active:scale-[0.97] transition-all duration-200">
                        Visit store
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                        </svg>
                    </a>
                    <!-- Non connecté → save intent puis /signin -->
                    <a *ngIf="!currentUser"
                       href="#"
                       (click)="goToStoreSignin(store.boutique._id, $event)"
                       class="flex-shrink-0 self-start sm:self-auto inline-flex items-center gap-2 px-4 py-2.5 text-sm font-bold rounded-xl border-2 border-gray-900 dark:border-gray-600 text-gray-900 dark:text-white hover:bg-gray-900 hover:text-white dark:hover:bg-white dark:hover:text-gray-900 dark:hover:border-white active:scale-[0.97] transition-all duration-200">
                        Sign in to visit
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                        </svg>
                    </a>
                </div>

                <!-- ── Products ─────────────────────────── -->
                <div *ngIf="store.products.length > 0"
                     class="px-5 sm:px-6 pb-5 sm:pb-6">

                    <!-- Séparateur élégant -->
                    <div class="flex items-center gap-3 mb-4">
                        <div class="h-px flex-1 bg-gray-100 dark:bg-gray-800"></div>
                        <span class="text-xs font-semibold text-gray-400 dark:text-gray-600 uppercase tracking-widest">Top products</span>
                        <div class="h-px flex-1 bg-gray-100 dark:bg-gray-800"></div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div *ngFor="let product of store.products"
                             class="group/card relative rounded-2xl overflow-hidden bg-gray-50 dark:bg-gray-800/60 border border-gray-100 dark:border-gray-700/60 hover:border-brand-200 dark:hover:border-brand-800 hover:shadow-xl hover:shadow-brand-500/8 transition-all duration-400 cursor-pointer">

                            <!-- Image wrapper -->
                            <div class="relative overflow-hidden bg-gray-100 dark:bg-gray-700"
                                 style="aspect-ratio: 16/10;">
                                <img [src]="getProductImage(product)" [alt]="product.name"
                                     class="w-full h-full object-cover group-hover/card:scale-110 transition-transform duration-700 ease-out"/>

                                <!-- Gradient bottom pour lisibilité -->
                                <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover/card:opacity-100 transition-opacity duration-300"></div>

                                <!-- Badge SALE -->
                                <div *ngIf="product.isSale && getSalePercent(product) > 0"
                                     class="absolute top-2.5 left-2.5 z-10">
                                    <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-black bg-red-500 text-white shadow-lg shadow-red-500/30 tracking-wide">
                                        -{{ getSalePercent(product) }}%
                                    </span>
                                </div>

                                <!-- Badge rating flottant -->
                                <div *ngIf="product.avgRating > 0"
                                     class="absolute top-2.5 right-2.5 z-10">
                                    <div class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-black/50 backdrop-blur-sm text-white text-xs font-bold">
                                        <svg class="w-3 h-3 fill-amber-400" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                        </svg>
                                        {{ product.avgRating | number:'1.1-1' }}
                                    </div>
                                </div>

                                <!-- Hover CTA overlay -->
                                <div class="absolute inset-0 flex items-end justify-center pb-3 opacity-0 group-hover/card:opacity-100 transition-all duration-300 z-10">
                                    <!-- User connecté → lien direct -->
                                    <a *ngIf="currentUser?.role === 'user'"
                                       [routerLink]="getProductRoute(store.boutique._id, product._id)"
                                       class="inline-flex items-center gap-1.5 px-4 py-2 bg-white/95 backdrop-blur-sm text-gray-900 text-xs font-bold rounded-xl shadow-xl hover:bg-white active:scale-[0.97] transition-all duration-150 transform translate-y-2 group-hover/card:translate-y-0">
                                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                                        </svg>
                                        View product
                                    </a>
                                    <!-- Non connecté → save intent puis /signin -->
                                    <a *ngIf="!currentUser"
                                       href="#"
                                       (click)="goToProductSignin(store.boutique._id, product._id, $event)"
                                       class="inline-flex items-center gap-1.5 px-4 py-2 bg-white/95 backdrop-blur-sm text-gray-900 text-xs font-bold rounded-xl shadow-xl hover:bg-white active:scale-[0.97] transition-all duration-150 transform translate-y-2 group-hover/card:translate-y-0">
                                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                                        </svg>
                                        Sign in to order
                                    </a>
                                </div>
                            </div>

                            <!-- Infos produit -->
                            <div class="p-3.5 space-y-2">

                                <!-- Nom -->
                                <p class="text-sm font-bold text-gray-900 dark:text-white truncate group-hover/card:text-brand-600 dark:group-hover/card:text-brand-400 transition-colors duration-200">
                                    {{ product.name }}
                                </p>

                                <!-- Catégorie + Rating sur la même ligne -->
                                <div class="flex items-center justify-between gap-2">

                                    <!-- Catégorie -->
                                    <span *ngIf="product.category"
                                          class="inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-xs font-semibold bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 truncate max-w-[120px]">
                                        <svg class="w-3 h-3 flex-shrink-0 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                                        </svg>
                                        {{ product.category.name }}
                                    </span>

                                    <!-- Rating -->
                                    <div *ngIf="product.avgRating > 0" class="flex items-center gap-1 flex-shrink-0">
                                        <div class="flex gap-0.5">
                                            <svg *ngFor="let s of getStars(product.avgRating)"
                                                 class="w-3 h-3 fill-amber-400" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                            </svg>
                                            <svg *ngFor="let s of getEmptyStars(product.avgRating)"
                                                 class="w-3 h-3 fill-gray-200 dark:fill-gray-600" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                            </svg>
                                        </div>
                                        <span class="text-xs text-gray-400 dark:text-gray-500 tabular-nums">
                                            {{ product.avgRating | number:'1.1-1' }}
                                            <span *ngIf="product.totalRatings > 0" class="text-gray-300 dark:text-gray-600">({{ product.totalRatings }})</span>
                                        </span>
                                    </div>
                                    <!-- Pas encore noté -->
                                    <span *ngIf="!product.avgRating || product.avgRating === 0"
                                          class="text-xs text-gray-300 dark:text-gray-600 italic flex-shrink-0">No reviews</span>
                                </div>

                                <!-- Prix -->
                                <div class="flex items-baseline gap-2 pt-0.5">
                                    <span *ngIf="product.isSale && product.salePrice"
                                          class="text-sm font-black text-red-500 dark:text-red-400 leading-none">
                                        {{ product.salePrice.toLocaleString('fr-MG') }} Ar
                                    </span>
                                    <span [class]="(product.isSale && product.salePrice)
                                        ? 'text-xs text-gray-400 dark:text-gray-500 line-through leading-none'
                                        : 'text-sm font-black text-gray-900 dark:text-white leading-none'">
                                        {{ product.regularPrice.toLocaleString('fr-MG') }} Ar
                                    </span>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- ── LOAD MORE ───────────────────────────────── -->
        <div *ngIf="!isAuthLoading && !isInitialLoading && !hasError && (hasMore || isLoadingMore)"
             class="flex justify-center mt-10">
            <button (click)="loadMore()"
                    [disabled]="isLoadingMore"
                    class="group inline-flex items-center gap-3 px-7 py-3.5 rounded-2xl border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-700 dark:text-gray-300 text-sm font-semibold hover:border-brand-400 dark:hover:border-brand-600 hover:text-brand-600 dark:hover:text-brand-400 hover:shadow-lg hover:shadow-brand-500/10 disabled:opacity-50 disabled:cursor-not-allowed active:scale-[0.98] transition-all duration-200">
                <svg *ngIf="isLoadingMore" class="w-4 h-4 animate-spin text-brand-500" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
                </svg>
                <svg *ngIf="!isLoadingMore"
                     class="w-4 h-4 group-hover:translate-y-0.5 transition-transform duration-200"
                     fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                </svg>
                {{ isLoadingMore ? 'Loading...' : 'Load more stores' }}
            </button>
        </div>

        <!-- Fin de liste -->
        <div *ngIf="!isAuthLoading && !isInitialLoading && !hasError && !hasMore && stores.length > 0"
             class="flex items-center gap-4 mt-10">
            <div class="h-px flex-1 bg-gray-200 dark:bg-gray-800"></div>
            <span class="text-xs font-semibold text-gray-400 dark:text-gray-600 uppercase tracking-widest">
                All {{ total }} stores shown
            </span>
            <div class="h-px flex-1 bg-gray-200 dark:bg-gray-800"></div>
        </div>

        <!-- ── CTA bottom ──────────────────────────────── -->
        <div *ngIf="!isAuthLoading && !isInitialLoading && stores.length > 0" class="mt-16">

            <!-- Guest → Ready to shop -->
            <div *ngIf="showGuestCta"
                 class="relative bg-gradient-to-br from-brand-500 via-brand-600 to-purple-600 rounded-3xl p-8 sm:p-12 text-center overflow-hidden shadow-2xl shadow-brand-500/20">
                <div class="absolute -top-16 -right-16 w-56 h-56 bg-white/10 rounded-full pointer-events-none"></div>
                <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-purple-400/20 rounded-full pointer-events-none"></div>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-white/5 rounded-full pointer-events-none"></div>
                <div class="relative">
                    <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-white/15 backdrop-blur-sm border border-white/20 rounded-full mb-6">
                        <span class="w-1.5 h-1.5 rounded-full bg-white animate-pulse"></span>
                        <span class="text-xs font-semibold text-white/90 tracking-wide">You're browsing as a guest</span>
                    </div>
                    <h2 class="text-3xl sm:text-4xl font-bold text-white mb-3 leading-tight">Ready to start shopping?</h2>
                    <p class="text-brand-100/80 mb-8 max-w-md mx-auto text-base leading-relaxed">
                        Create a free account to order, track deliveries and save your favorite products.
                    </p>
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                        <a routerLink="/signup"
                           class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-7 py-3.5 bg-white text-brand-600 text-sm font-bold rounded-xl hover:bg-brand-50 shadow-2xl shadow-black/20 active:scale-[0.98] transition-all duration-200">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            Create free account
                        </a>
                        <a routerLink="/signin"
                           class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-7 py-3.5 border border-white/30 text-white text-sm font-semibold rounded-xl hover:bg-white/10 hover:border-white/60 transition-all duration-200 active:scale-[0.98]">
                            Sign in
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>

            <!-- User connecté → Explore the map -->
            <div *ngIf="showMapCta"
                 class="relative bg-gradient-to-br from-brand-500 via-brand-600 to-purple-600 rounded-3xl p-8 sm:p-12 text-center overflow-hidden shadow-2xl shadow-brand-500/20">
                <div class="absolute -top-16 -right-16 w-56 h-56 bg-white/10 rounded-full pointer-events-none"></div>
                <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-purple-400/20 rounded-full pointer-events-none"></div>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-white/5 rounded-full pointer-events-none"></div>
                <div class="relative">
                    <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-white/15 backdrop-blur-sm border border-white/20 rounded-full mb-6">
                        <span class="w-1.5 h-1.5 rounded-full bg-white animate-pulse"></span>
                        <span class="text-xs font-semibold text-white/90 tracking-wide">Explore stores near you</span>
                    </div>
                    <h2 class="text-3xl sm:text-4xl font-bold text-white mb-3 leading-tight">Find stores on the map</h2>
                    <p class="text-brand-100/80 mb-8 max-w-md mx-auto text-base leading-relaxed">
                        Discover stores around you, check their location and start shopping with full access.
                    </p>
                    <a routerLink="/v1/maps"
                       class="inline-flex items-center gap-3 px-8 py-4 bg-white text-brand-600 text-sm font-bold rounded-xl hover:bg-brand-50 shadow-2xl shadow-black/20 active:scale-[0.98] transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                        </svg>
                        Open integrated map
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                        </svg>
                    </a>
                </div>
            </div>

        </div>

    </div>
</div>