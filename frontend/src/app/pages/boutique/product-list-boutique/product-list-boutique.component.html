<app-page-breadcrumb [breadcrumbs]="[{ label: 'Store', link: '/store/app' }, { label: 'Products' }]" />

<div class="space-y-6">
  <!-- Header Card -->
  <div class="overflow-hidden rounded-2xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
    <div class="px-4 pt-4 sm:px-6">
      <div class="flex flex-col gap-4 mb-6 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Products</h3>
        </div>

        <div class="flex items-center gap-2">
          <app-button
            size="sm"
            variant="primary"
            [startIcon]="addIcon"
            (btnClick)="addProduct()">
            Add Product
          </app-button>
        </div>
      </div>

      <!-- Search and Filters -->
      <div class="flex flex-col gap-4 mb-6 sm:flex-row sm:items-center sm:justify-between">
        <!-- Search Input -->
        <div class="flex-1">
          <input type="text" placeholder="Search products..." [(ngModel)]="searchTerm" (input)="onSearch(searchTerm)"
            class="w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-theme-sm text-gray-900 placeholder-gray-500 shadow-theme-xs focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90" />
        </div>

        <!-- Filter Buttons -->
        <div class="flex items-center gap-2">
          <button *ngFor="let filter of ['all','active','inactive']" (click)="onFilterChange(filter)"
            [ngClass]="statusFilter === filter ? 'bg-blue-600 text-white dark:bg-blue-600' : 'border border-gray-300 bg-white text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400'"
            class="inline-flex items-center rounded-lg px-3 py-2 text-theme-sm font-medium shadow-theme-xs hover:shadow-theme-sm transition-all whitespace-nowrap">
            {{ filter | titlecase }}
          </button>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="max-w-full overflow-x-auto">
      <table class="w-full">
        <thead class="border-gray-100 border-y dark:border-white/[0.05]">
          <tr>
            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Image</th>
            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Name</th>
            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Price</th>
            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Stock</th>
            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Status</th>
              <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Created</th>
              <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-center text-theme-xs dark:text-gray-400">Actions</th>
          </tr>
        </thead>
          <tbody class="divide-y divide-gray-100 dark:divide-white/[0.05]">
              @if (loading) {
                  @for (i of [1,2,3,4,5]; track i) {
                      <tr class="animate-pulse">
                          <!-- Image Column -->
                          <td class="px-4 py-3 sm:px-6">
                              <div class="h-12 w-12 rounded-md bg-gray-200 dark:bg-gray-700"></div>
                          </td>

                          <!-- Name & Description Column -->
                          <td class="px-4 py-3 sm:px-6">
                              <div class="flex flex-col space-y-2">
                                  <div class="h-4 w-32 rounded bg-gray-200 dark:bg-gray-700"></div>
                                  <div class="h-3 w-48 rounded bg-gray-200 dark:bg-gray-700"></div>
                              </div>
                          </td>

                          <!-- Price Column -->
                          <td class="px-4 py-3 sm:px-6">
                              <div class="h-4 w-16 rounded bg-gray-200 dark:bg-gray-700"></div>
                          </td>

                          <!-- Stock Column -->
                          <td class="px-4 py-3 sm:px-6">
                              <div class="flex items-center gap-3">
                                  <div class="h-4 w-8 rounded bg-gray-200 dark:bg-gray-700"></div>
                                  <div class="h-6 w-20 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                              </div>
                          </td>

                          <!-- Status Column -->
                          <td class="px-4 py-3 sm:px-6">
                              <div class="h-6 w-16 rounded-md bg-gray-200 dark:bg-gray-700"></div>
                          </td>

                          <!-- Created Date Column -->
                          <td class="px-4 py-3 sm:px-6">
                              <div class="h-4 w-24 rounded bg-gray-200 dark:bg-gray-700"></div>
                          </td>

                          <!-- Actions Column -->
                          <td class="px-4 py-3 sm:px-6">
                              <div class="flex items-center justify-center">
                                  <div class="h-8 w-16 rounded-md bg-gray-200 dark:bg-gray-700"></div>
                              </div>
                          </td>
                      </tr>
                  }
              } @else {
                  <!-- Loop products -->
                  <tr *ngFor="let product of products" class="hover:bg-gray-50 dark:hover:bg-white/[0.02] transition-colors">
                      <td class="px-4 py-3 sm:px-6 text-theme-sm text-gray-800 dark:text-white/90">
                          <img [src]="product.images[0] || '/assets/images/product-placeholder.png'" [alt]="product.name"
                               class="h-12 w-12 rounded-md object-cover border border-gray-200 dark:border-gray-700" />
                      </td>

                      <td class="px-4 py-3 font-medium text-gray-800 sm:px-6 text-start text-theme-sm dark:text-white/90">
                          <div class="flex flex-col">
                              <span class="font-medium">{{ product.name }}</span>
                              <span class="text-xs text-gray-500 dark:text-gray-400">{{ product.description | slice:0:60 }}...</span>
                          </div>
                      </td>

                      <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">
                          {{ product.salePrice || product.regularPrice }}
                      </td>

                      <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">
                          <div class="flex items-center gap-3">
                              <span class="text-sm font-semibold text-gray-900 dark:text-white">{{ product.stock }}</span>
                              <span class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-semibold"
                                    [ngClass]="getStockBadgeClasses(getStockStatus(product))">
                        <span class="h-1.5 w-1.5 rounded-full"
                              [ngClass]="getStockStatus(product) === 'in-stock' ? 'bg-emerald-500' : getStockStatus(product) === 'low-stock' ? 'bg-amber-500' : 'bg-red-500'"></span>
                                  {{ getStockStatus(product) === 'out-of-stock' ? 'Out of stock' : getStockStatus(product) === 'low-stock' ? 'Low stock' : 'In stock' }}
                    </span>
                          </div>
                      </td>

                      <td class="px-4 py-3 sm:px-6 text-start text-theme-sm">
                <span [ngClass]="getStatusBgColor(product.isActive)"
                      class="inline-flex px-2.5 py-1 rounded-md text-xs font-medium">
                    {{ getStatusText(product.isActive) }}
                </span>
                      </td>

                      <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">
                          {{ formatDate(product.createdAt) }}
                      </td>

                      <td class="px-4 py-3 sm:px-6 text-center text-theme-sm">
                          <div class="flex items-center justify-center gap-2">
                              <button (click)="viewProduct(product._id)"
                                      class="inline-flex items-center gap-1 rounded-md border border-gray-300 bg-white px-2.5 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] transition-colors">
                                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5C17 19.5 21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12C15 10.34 13.66 9 12 9Z" fill="currentColor"/>
                                  </svg>
                                  View
                              </button>
                          </div>
                      </td>
                  </tr>

                  <!-- Empty state -->
                  <tr *ngIf="!products.length && !loading">
                      <td colspan="7" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                          <p class="text-theme-sm">No products found</p>
                      </td>
                  </tr>
              }
          </tbody>
      </table>
    </div>

    <!-- Footer with Pagination -->
    <div class="border-t border-gray-100 px-4 py-4 sm:px-6 dark:border-white/[0.05]">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <p class="text-theme-sm text-gray-600 dark:text-gray-400">
          Showing
          <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span>
          to
          <span class="font-medium">{{ Math.min(currentPage * itemsPerPage, totalDocs) }}</span>
          of
          <span class="font-medium">{{ totalDocs }}</span>
          results
        </p>

        <!-- Pagination Controls -->
        <div class="flex items-center gap-2">
          <button (click)="previousPage()" [disabled]="currentPage === 1"
            class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-3 py-2 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
            Previous
          </button>

          <ng-container *ngFor="let i of [].constructor(totalPages); let idx = index">
            <button (click)="goToPage(idx + 1)" [ngClass]="currentPage === idx + 1 ? 'bg-blue-600 text-white border-blue-600 dark:bg-blue-600' : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400'"
              class="inline-flex items-center rounded-lg border px-3 py-2 text-theme-sm font-medium shadow-theme-xs transition-colors">
              {{ idx + 1 }}
            </button>
          </ng-container>

          <button (click)="nextPage()" [disabled]="currentPage === totalPages"
            class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-3 py-2 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
            Next
          </button>
        </div>
      </div>
    </div>
</div>
</div>

