<!-- ══ BILLING TAB ══ -->
<div class="space-y-4">

    <!-- ── No plan yet (not validated) ── -->
    <div *ngIf="!boutique?.plan?.type"
         class="rounded-2xl border border-dashed border-amber-300 dark:border-amber-700/50 bg-amber-50 dark:bg-amber-900/10 p-8 text-center">
        <div class="w-14 h-14 rounded-2xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center mx-auto mb-4">
            <svg class="w-7 h-7 text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
        </div>
        <h3 class="text-base font-bold text-amber-800 dark:text-amber-300 mb-1">Awaiting Activation</h3>
        <p class="text-sm text-amber-600 dark:text-amber-400 max-w-sm mx-auto">
            Your billing plan will be configured once an administrator validates your shop. No charges until then.
        </p>
    </div>

    <!-- ── Plan active ── -->
    <div *ngIf="boutique?.plan?.type">
        <div class="grid gap-4 grid-cols-1 lg:grid-cols-3">

            <!-- Left: Plan + Billing dates -->
            <div class="lg:col-span-2 space-y-4">

                <!-- Subscription plan card -->
                <div class="rounded-2xl border border-gray-200 dark:border-white/[0.05] bg-white dark:bg-gray-900 shadow-sm overflow-hidden">
                    <div class="px-6 pt-5 pb-4 border-b border-gray-100 dark:border-white/[0.05]">
                        <h2 class="text-xs font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest">Subscription Plan</h2>
                    </div>
                    <div class="p-6 space-y-5">

                        <!-- Plan type hero -->
                        <div class="flex items-center gap-4 p-4 rounded-xl border-2"
                             [ngClass]="boutique?.plan?.type === 'A'
                                 ? 'border-brand-200 dark:border-brand-800/50 bg-brand-50 dark:bg-brand-900/10'
                                 : 'border-emerald-200 dark:border-emerald-800/50 bg-emerald-50 dark:bg-emerald-900/10'">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 font-black text-xl"
                                 [ngClass]="boutique?.plan?.type === 'A'
                                     ? 'bg-brand-100 dark:bg-brand-900/30 text-brand-600 dark:text-brand-400'
                                     : 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400'">
                                {{ boutique?.plan?.type }}
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-black text-gray-900 dark:text-white mb-0.5">
                                    Plan {{ boutique?.plan?.type }}
                                    <span *ngIf="boutique?.plan?.type === 'A'" class="text-xs font-normal text-gray-400 ml-1">— External boutique</span>
                                    <span *ngIf="boutique?.plan?.type === 'B'" class="text-xs font-normal text-gray-400 ml-1">— In-mall boutique</span>
                                </p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">
                                    <span *ngIf="boutique?.plan?.type === 'A'">Billed monthly via credit card registered on account</span>
                                    <span *ngIf="boutique?.plan?.type === 'B'">Billed directly at headquarters — no card required</span>
                                </p>
                            </div>
                            <!-- Monthly price -->
                            <div class="text-right flex-shrink-0">
                                <p class="text-xl font-black text-gray-900 dark:text-white">
                                    {{ boutique?.plan?.priceToPayPerMonth | number:'1.0-0' }}
                                </p>
                                <p class="text-xs text-gray-400">Ar / month</p>
                            </div>
                        </div>

                        <!-- Billing details -->
                        <dl class="divide-y divide-gray-100 dark:divide-white/[0.04]">
                            <div class="py-3 flex items-center justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Monthly amount</dt>
                                <dd class="text-sm font-bold text-gray-900 dark:text-white">
                                    {{ boutique?.plan?.priceToPayPerMonth | number:'1.0-0' }} Ar
                                </dd>
                            </div>
                            <div class="py-3 flex items-center justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Billing reference day</dt>
                                <dd class="text-sm font-bold text-gray-900 dark:text-white">
                                    <span *ngIf="boutique?.plan?.startDate">
                                        {{ getBillingDay(boutique?.plan?.startDate) }}<sup class="text-xs">{{ getBillingDaySuffix(boutique?.plan?.startDate) }}</sup> of each month
                                    </span>
                                    <span *ngIf="!boutique?.plan?.startDate" class="text-gray-400">Not set</span>
                                </dd>
                            </div>
                            <div class="py-3 flex items-center justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Billing since</dt>
                                <dd class="text-sm font-semibold text-gray-900 dark:text-white">
                                    {{ formatDate(boutique?.plan?.startDate) }}
                                </dd>
                            </div>
                            <div class="py-3 flex items-center justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Next billing date</dt>
                                <dd>
                                    <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-400 text-xs font-bold">
                                        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        {{ getNextBillingDate(boutique?.plan?.startDate) }}
                                    </span>
                                </dd>
                            </div>
                        </dl>

                    </div>
                </div>

                <!-- Coming soon: invoices -->
                <div class="rounded-2xl border border-dashed border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-white/[0.02] p-5 flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-gray-100 dark:bg-white/[0.05] flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400">Invoice history</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-0.5">Monthly invoices will appear here — coming soon</p>
                    </div>
                </div>
            </div>

            <!-- Right: Card info or HQ billing notice -->
            <div class="space-y-4">

                <!-- Plan A: credit card -->
                <div *ngIf="boutique?.plan?.type === 'A'"
                     class="rounded-2xl border border-gray-200 dark:border-white/[0.05] bg-white dark:bg-gray-900 shadow-sm overflow-hidden">
                    <div class="px-5 pt-5 pb-4 border-b border-gray-100 dark:border-white/[0.05]">
                        <h2 class="text-xs font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest">Payment Card</h2>
                    </div>

                    <div *ngIf="boutique?.payment" class="p-5">
                        <!-- Card visual -->
                        <div class="rounded-2xl p-5 mb-4 relative overflow-hidden"
                             style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5986 50%, #1a3a5c 100%); min-height: 120px;">
                            <!-- Decorative circles -->
                            <div class="absolute -right-6 -bottom-6 w-32 h-32 rounded-full opacity-10 bg-white"></div>
                            <div class="absolute -right-2 -bottom-10 w-20 h-20 rounded-full opacity-10 bg-white"></div>

                            <div class="relative z-10">
                                <div class="flex items-start justify-between mb-4">
                                    <svg class="w-8 h-6 text-yellow-400" viewBox="0 0 50 32" fill="currentColor">
                                        <rect x="0" y="0" width="22" height="32" rx="3"/>
                                        <rect x="28" y="0" width="22" height="32" rx="3" opacity="0.7"/>
                                        <rect x="18" y="6" width="14" height="20" rx="2"/>
                                    </svg>
                                    <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                        </svg>
                                    </div>
                                </div>
                                <p class="text-sm font-mono font-bold text-white tracking-[0.15em]">
                                    {{ maskCardNumber(boutique?.payment?.cardNumber) }}
                                </p>
                                <div class="flex items-end justify-between mt-3">
                                    <div>
                                        <p class="text-[10px] text-white/50 uppercase tracking-wider mb-0.5">Cardholder</p>
                                        <p class="text-xs font-bold text-white tracking-wider">{{ boutique?.payment?.cardName }}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-[10px] text-white/50 uppercase tracking-wider mb-0.5">Expires</p>
                                        <p class="text-xs font-bold text-white">{{ boutique?.payment?.expiryDate }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card details -->
                        <dl class="space-y-2.5">
                            <div class="flex items-center justify-between">
                                <dt class="text-xs text-gray-400 dark:text-gray-500">Card number</dt>
                                <dd class="text-xs font-mono font-semibold text-gray-700 dark:text-gray-300">
                                    {{ maskCardNumber(boutique?.payment?.cardNumber) }}
                                </dd>
                            </div>
                            <div class="flex items-center justify-between">
                                <dt class="text-xs text-gray-400 dark:text-gray-500">Cardholder</dt>
                                <dd class="text-xs font-semibold text-gray-700 dark:text-gray-300">{{ boutique?.payment?.cardName }}</dd>
                            </div>
                            <div class="flex items-center justify-between">
                                <dt class="text-xs text-gray-400 dark:text-gray-500">Expiry</dt>
                                <dd class="text-xs font-semibold text-gray-700 dark:text-gray-300">{{ boutique?.payment?.expiryDate }}</dd>
                            </div>
                        </dl>

                        <div class="mt-4 px-3 py-2.5 rounded-lg bg-gray-50 dark:bg-white/[0.03] border border-gray-100 dark:border-white/[0.05]">
                            <p class="text-xs text-gray-400 dark:text-gray-500 flex items-center gap-1.5">
                                <svg class="w-3.5 h-3.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                                Card details are encrypted and secured
                            </p>
                        </div>
                    </div>

                    <!-- No card on file -->
                    <div *ngIf="!boutique?.payment" class="p-5 text-center">
                        <div class="w-12 h-12 rounded-2xl bg-gray-50 dark:bg-white/[0.04] flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-gray-300 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                            </svg>
                        </div>
                        <p class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">No card on file</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500">Contact an administrator to register a payment card</p>
                    </div>
                </div>

                <!-- Plan B: HQ billing notice -->
                <div *ngIf="boutique?.plan?.type === 'B'"
                     class="rounded-2xl border border-emerald-200 dark:border-emerald-800/40 bg-white dark:bg-gray-900 shadow-sm overflow-hidden">
                    <div class="px-5 pt-5 pb-4 border-b border-emerald-100 dark:border-emerald-800/30">
                        <h2 class="text-xs font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest">Payment Method</h2>
                    </div>
                    <div class="p-5 text-center">
                        <div class="w-14 h-14 rounded-2xl bg-emerald-50 dark:bg-emerald-900/20 flex items-center justify-center mx-auto mb-3">
                            <svg class="w-7 h-7 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                        <p class="text-sm font-bold text-gray-700 dark:text-gray-300 mb-1">Billed at Headquarters</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 leading-relaxed">
                            As an in-mall boutique (Plan B), your monthly fee is settled directly at our head office. No credit card is required.
                        </p>
                        <div class="mt-4 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800/40 text-emerald-700 dark:text-emerald-400 text-xs font-bold">
                            ✓ Card-free billing
                        </div>
                    </div>
                </div>

                <!-- Box info (Plan B has boxId) -->
                <div *ngIf="boutique?.boxId"
                     class="rounded-2xl border border-gray-200 dark:border-white/[0.05] bg-white dark:bg-gray-900 shadow-sm overflow-hidden">
                    <div class="px-5 pt-5 pb-4 border-b border-gray-100 dark:border-white/[0.05]">
                        <h2 class="text-xs font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest">Assigned Box</h2>
                    </div>
                    <div class="px-5 py-4 flex items-center gap-3">
                        <div class="w-9 h-9 rounded-xl bg-blue-50 dark:bg-blue-500/10 flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 dark:text-gray-500 mb-0.5">Box number</p>
                            <p class="text-sm font-bold text-gray-900 dark:text-white">{{ boutique?.boxId?.number || boutique?.boxId }}</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>