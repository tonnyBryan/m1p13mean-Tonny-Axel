<div class="mx-auto max-w-7xl">
    <div class="space-y-6">
        <!-- Breadcrumb -->
        <app-page-breadcrumb [pageTitle]="pageTitle" [breadcrumbs]="[
        { label: 'Admin', link: '/admin' },
        { label: 'Shops', link: '/admin/app/boutiques' },
        { label: 'Details' }
    ]"></app-page-breadcrumb>

        <!-- Success Alert -->
        @if (showSuccessAlert) {
            <div class="mb-6" [ngClass]="isSuccessFadingOut ? 'alert-fade-out' : 'alert-fade-in'">
                <app-alert variant="success" title="Success!" [message]="alertMessage"></app-alert>
            </div>
        }

        <!-- Error Alert -->
        @if (showErrorAlert) {
            <div class="mb-6" [ngClass]="isErrorFadingOut ? 'alert-fade-out' : 'alert-fade-in'">
                <app-alert variant="error" title="Error" [message]="alertMessage"></app-alert>
            </div>
        }

        <!-- app-modal SUPPRIMÉ — remplacé par toast.confirm dans le TS -->

        <!-- Loading State -->
        @if (isLoading) {
            <div class="space-y-6 animate-pulse">
                <div class="overflow-hidden rounded-2xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                    <div class="px-6 py-8">
                        <div class="flex items-center gap-6">
                            <div class="h-24 w-24 rounded-2xl bg-gray-200 dark:bg-gray-700"></div>
                            <div class="flex-1 space-y-3">
                                <div class="h-8 w-64 rounded bg-gray-200 dark:bg-gray-700"></div>
                                <div class="h-6 w-24 rounded bg-gray-200 dark:bg-gray-700"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid gap-6 grid-cols-1 lg:grid-cols-2">
                    <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                        <div class="h-6 w-48 mb-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                        <div class="space-y-4">
                            <div class="h-16 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                            <div class="h-16 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                            <div class="h-16 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                        </div>
                    </div>
                    <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                        <div class="h-6 w-48 mb-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                        <div class="space-y-4">
                            <div class="h-16 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                            <div class="h-16 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                            <div class="h-16 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                        </div>
                    </div>
                </div>
                <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                    <div class="h-6 w-48 mb-6 rounded bg-gray-200 dark:bg-gray-700"></div>
                    <div class="grid gap-4 grid-cols-1 md:grid-cols-2">
                        <div class="h-20 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                        <div class="h-20 w-full rounded-lg bg-gray-200 dark:bg-gray-700"></div>
                    </div>
                </div>
            </div>
        }

        <!-- Boutique Details -->
        @if (!isLoading && boutique) {
            <div class="space-y-6">
                <!-- Header Card -->
                <div class="overflow-hidden rounded-2xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                    <div class="px-6 py-8 bg-white dark:bg-white/[0.03]">
                        <div class="flex items-center gap-6">
                            <img [src]="boutique.logo" [alt]="boutique.name"
                                 class="h-24 w-24 rounded-2xl object-cover border-2 border-gray-200 dark:border-gray-700 shadow-lg" />
                            <div class="flex-1">
                                <h1 class="text-3xl font-bold text-gray-900 dark:text-white/90 mb-2">{{ boutique.name }}</h1>
                                <span [ngClass]="getStatusBgColor(boutique.isActive, boutique.isValidated)"
                                      class="inline-flex px-2.5 py-1 rounded-md text-xs font-medium">
                            {{ getStatusText(boutique.isActive, boutique.isValidated) }}
                        </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Information Grid -->
                <div class="grid gap-6 grid-cols-1 lg:grid-cols-2">
                    <!-- General Information Card -->
                    <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white/90 mb-6 flex items-center gap-2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="text-blue-600">
                                <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            General Information
                        </h2>
                        <div class="space-y-4">
                            <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                    <path d="M10 2L3 7L10 12L17 7L10 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M3 12L10 17L17 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Boutique Name</p>
                                    <p class="mt-1 text-base font-semibold text-gray-900 dark:text-white/90">{{ boutique.name }}</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                    <path d="M9 2C9 2 4 4 4 8C4 12 9 18 9 18C9 18 14 12 14 8C14 4 9 2 9 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Description</p>
                                    <p class="mt-1 text-base text-gray-900 dark:text-white/90">{{ boutique.description }}</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                    <path d="M10 11C11.6569 11 13 9.65685 13 8C13 6.34315 11.6569 5 10 5C8.34315 5 7 6.34315 7 8C7 9.65685 8.34315 11 10 11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M10 14C6.68629 14 4 16.6863 4 20H16C16 16.6863 13.3137 14 10 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Owner ID</p>
                                    <p class="mt-1 text-base font-mono text-gray-900 dark:text-white/90">{{ boutique.owner }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status & Dates Card -->
                    <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white/90 mb-6 flex items-center gap-2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="text-blue-600">
                                <path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Status & Timeline
                        </h2>
                        <div class="space-y-4">

                            <!-- ── Active Status row — MODIFIÉ ── -->
                            <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="1.5"/>
                                    <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Active Status</p>

                                        <!-- Toggle avec spinner intégré pendant isUpdating -->
                                        <button (click)="toggleActiveStatus()" [disabled]="isUpdating"
                                                class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed"
                                                [ngClass]="{
                                        'bg-green-600 dark:bg-green-600': boutique.isActive && !isUpdating,
                                        'bg-gray-300 dark:bg-gray-600': !boutique.isActive && !isUpdating,
                                        'bg-blue-400 dark:bg-blue-500': isUpdating
                                    }">
                                            <!-- Spinner si isUpdating -->
                                            @if (isUpdating) {
                                                <span class="absolute inset-0 flex items-center justify-center">
                                        <svg class="animate-spin h-3.5 w-3.5 text-white" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
                                        </svg>
                                    </span>
                                            } @else {
                                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"
                                                      [ngClass]="boutique.isActive ? 'translate-x-6' : 'translate-x-1'">
                                    </span>
                                            }
                                        </button>
                                    </div>

                                    <div class="mt-2 flex items-center gap-2">
                                        @if (boutique.isActive) {
                                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 text-xs font-medium">
                                    <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                                        <path d="M13.3333 4L6 11.3333L2.66667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Active
                                </span>
                                        } @else {
                                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 text-xs font-medium">
                                    <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                                        <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Inactive
                                </span>
                                        }
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                    <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Validation Status</p>
                                    <div class="mt-2">
                                        @if (boutique.isValidated) {
                                            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 text-sm font-medium">
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                        <path d="M13.3333 4L6 11.3333L2.66667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Validated
                                </span>
                                        } @else {
                                            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 text-sm font-medium">
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 5V8M8 11H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                    Pending Validation
                                </span>
                                        }
                                    </div>
                                    @if (!boutique.isValidated) {
                                        <div class="mt-4">
                                            <button (click)="validateBoutique()" [disabled]="isValidating || !boutique.isActive"
                                                    class="inline-flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-semibold text-white shadow-sm transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed"
                                                    [ngClass]="isValidating ? 'bg-blue-400' : 'bg-blue-600 hover:bg-blue-700'">
                                                @if (isValidating) {
                                                    <svg class="animate-spin h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
                                                    </svg>
                                                    Validating...
                                                } @else {
                                                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                                                    </svg>
                                                    Validate Shop
                                                }
                                            </button>
                                        </div>
                                    }
                                </div>
                            </div>

                            <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                    <path d="M10 5V10L13 12M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Created At</p>
                                    <p class="mt-1 text-base text-gray-900 dark:text-white/90">{{ formatDate(boutique.createdAt) }}</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                    <path d="M5 10H15M10 5V15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Last Updated</p>
                                    <p class="mt-1 text-base text-gray-900 dark:text-white/90">{{ formatDate(boutique.updatedAt) }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Information Card -->
                <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03] shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white/90 mb-6 flex items-center gap-2">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="text-blue-600">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        System Information
                    </h2>
                    <div class="grid gap-4 grid-cols-1 md:grid-cols-2">
                        <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                <path d="M2 4H18M2 10H18M2 16H18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Boutique ID</p>
                                <p class="mt-1 text-sm font-mono text-gray-900 dark:text-white/90 break-all">{{ boutique._id }}</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 p-4 rounded-lg bg-gray-50 dark:bg-white/[0.02]">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="text-gray-500 dark:text-gray-400 mt-0.5">
                                <path d="M10 1L3 6V14L10 19L17 14V6L10 1Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Logo URL</p>
                                <p class="mt-1 text-sm text-gray-900 dark:text-white/90 break-all">
                                    <a [href]="boutique.logo" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">
                                        {{ boutique.logo }}
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
