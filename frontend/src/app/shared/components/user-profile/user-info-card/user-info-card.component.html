<!-- ══ PERSONAL INFORMATION ══ -->
<div class="rounded-2xl border border-gray-200 dark:border-white/[0.05] bg-white dark:bg-gray-900 shadow-sm overflow-hidden h-full">

    <!-- Header -->
    <div class="px-5 sm:px-6 pt-5 pb-4 border-b border-gray-100 dark:border-white/[0.05] flex items-center justify-between">
        <h2 class="text-sm font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest">Personal Info</h2>
        <button (click)="openModal()"
                class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
            <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 18 18">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0911 2.78206C14.2125 1.90338 12.7878 1.90338 11.9092 2.78206L4.57524 10.116C4.26682 10.4244 4.0547 10.8158 3.96468 11.2426L3.31231 14.3352C3.25997 14.5833 3.33653 14.841 3.51583 15.0203C3.69512 15.1996 3.95286 15.2761 4.20096 15.2238L7.29355 14.5714C7.72031 14.4814 8.11172 14.2693 8.42013 13.9609L15.7541 6.62695C16.6327 5.74827 16.6327 4.32365 15.7541 3.44497L15.0911 2.78206Z"/>
            </svg>
            Edit
        </button>
    </div>

    <!-- Info rows -->
    <dl class="px-5 sm:px-6 py-5 divide-y divide-gray-100 dark:divide-white/[0.04]">
        <!-- Name row -->
        <div class="py-4 grid grid-cols-2 gap-4">
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <svg class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
                <div class="min-w-0">
                    <dt class="text-xs font-semibold text-gray-400 dark:text-gray-500 mb-0.5">First Name</dt>
                    <dd class="text-sm font-semibold text-gray-900 dark:text-white truncate">{{ profile?.firstName || '—' }}</dd>
                </div>
            </div>
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <svg class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
                <div class="min-w-0">
                    <dt class="text-xs font-semibold text-gray-400 dark:text-gray-500 mb-0.5">Last Name</dt>
                    <dd class="text-sm font-semibold text-gray-900 dark:text-white truncate">{{ profile?.lastName || '—' }}</dd>
                </div>
            </div>
        </div>
        <!-- Email -->
        <div class="py-4 flex items-start gap-3">
            <div class="w-8 h-8 rounded-lg bg-purple-50 dark:bg-purple-500/10 flex items-center justify-center flex-shrink-0 mt-0.5">
                <svg class="w-4 h-4 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
            </div>
            <div class="min-w-0 flex-1">
                <dt class="text-xs font-semibold text-gray-400 dark:text-gray-500 mb-0.5">Email Address</dt>
                <dd class="text-sm font-semibold text-gray-900 dark:text-white truncate">{{ authService.userHash?.email || '—' }}</dd>
            </div>
        </div>
        <!-- Phone -->
        <div class="py-4 flex items-start gap-3">
            <div class="w-8 h-8 rounded-lg bg-emerald-50 dark:bg-emerald-500/10 flex items-center justify-center flex-shrink-0 mt-0.5">
                <svg class="w-4 h-4 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
            </div>
            <div class="min-w-0 flex-1">
                <dt class="text-xs font-semibold text-gray-400 dark:text-gray-500 mb-0.5">Phone</dt>
                <dd class="text-sm font-semibold text-gray-900 dark:text-white">{{ profile?.phoneNumber || '—' }}</dd>
            </div>
        </div>
        <!-- Bio -->
        <div class="py-4 flex items-start gap-3">
            <div class="w-8 h-8 rounded-lg bg-orange-50 dark:bg-orange-500/10 flex items-center justify-center flex-shrink-0 mt-0.5">
                <svg class="w-4 h-4 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h12M4 18h8"/>
                </svg>
            </div>
            <div class="min-w-0 flex-1">
                <dt class="text-xs font-semibold text-gray-400 dark:text-gray-500 mb-0.5">Bio</dt>
                <dd class="text-sm text-gray-700 dark:text-gray-300 leading-relaxed">{{ profile?.description || '—' }}</dd>
            </div>
        </div>
    </dl>
</div>

<!-- ══ MODAL: Edit Personal Info — raw backdrop, lazy errors (only after user touches field) ══ -->
<div *ngIf="isOpen"
     class="fixed inset-0 z-[999999] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden">

        <!-- Header -->
        <div class="flex-shrink-0 flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
            <div>
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">Edit Personal Information</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-0.5">Update your details to keep your profile accurate</p>
            </div>
            <button type="button" (click)="closeModal()"
                    class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex-shrink-0">
                <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <!-- Body -->
        <div class="flex-1 overflow-y-auto custom-scrollbar p-6">
            <form #infoForm="ngForm" class="space-y-5">

                <!-- Name row -->
                <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">

                    <!-- First Name -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5">
                            First Name <span class="text-red-500">*</span>
                        </label>
                        <input #firstName="ngModel"
                               type="text"
                               [(ngModel)]="form.firstName"
                               (ngModelChange)="updateFormInvalid()"
                               name="firstName"
                               required
                               placeholder="Your first name"
                               class="w-full px-4 py-3 rounded-xl border text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all"
                               [ngClass]="firstName.touched && (!form.firstName || form.firstName.trim() === '' || !isInputSafe(form.firstName) || !isValidNameFormat(form.firstName))
                                   ? 'border-red-400 dark:border-red-500'
                                   : 'border-gray-300 dark:border-gray-600'"/>
                        <!-- Error — only shown after field is touched -->
                        <div *ngIf="firstName.touched" class="mt-1.5 space-y-0.5">
                            <p *ngIf="!form.firstName || form.firstName.trim() === ''"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                First name is required
                            </p>
                            <p *ngIf="form.firstName && form.firstName.trim() !== '' && !isInputSafe(form.firstName)"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Contains invalid characters
                            </p>
                            <p *ngIf="form.firstName && form.firstName.trim() !== '' && isInputSafe(form.firstName) && !isValidNameFormat(form.firstName)"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Letters, spaces, hyphens only
                            </p>
                        </div>
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5">
                            Last Name <span class="text-red-500">*</span>
                        </label>
                        <input #lastName="ngModel"
                               type="text"
                               [(ngModel)]="form.lastName"
                               (ngModelChange)="updateFormInvalid()"
                               name="lastName"
                               required
                               placeholder="Your last name"
                               class="w-full px-4 py-3 rounded-xl border text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all"
                               [ngClass]="lastName.touched && (!form.lastName || form.lastName.trim() === '' || !isInputSafe(form.lastName) || !isValidNameFormat(form.lastName))
                                   ? 'border-red-400 dark:border-red-500'
                                   : 'border-gray-300 dark:border-gray-600'"/>
                        <div *ngIf="lastName.touched" class="mt-1.5 space-y-0.5">
                            <p *ngIf="!form.lastName || form.lastName.trim() === ''"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Last name is required
                            </p>
                            <p *ngIf="form.lastName && form.lastName.trim() !== '' && !isInputSafe(form.lastName)"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Contains invalid characters
                            </p>
                            <p *ngIf="form.lastName && form.lastName.trim() !== '' && isInputSafe(form.lastName) && !isValidNameFormat(form.lastName)"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Letters, spaces, hyphens only
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Email readonly -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5">Email Address</label>
                    <div class="flex items-center gap-3 px-4 py-3 rounded-xl bg-gray-50 dark:bg-gray-900/60 border border-gray-200 dark:border-gray-700">
                        <svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                        <span class="text-sm text-gray-500 dark:text-gray-400 truncate">{{ authService.userHash?.email || '—' }}</span>
                        <span class="ml-auto flex-shrink-0 text-xs text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-md">Read-only</span>
                    </div>
                </div>

                <!-- Phone + Bio row -->
                <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">

                    <!-- Phone -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5">Phone</label>
                        <input #phoneNumber="ngModel"
                               type="text"
                               [(ngModel)]="form.phoneNumber"
                               (ngModelChange)="updateFormInvalid()"
                               name="phoneNumber"
                               placeholder="+261341234567"
                               class="w-full px-4 py-3 rounded-xl border text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all"
                               [ngClass]="phoneNumber.touched && form.phoneNumber && (!isInputSafe(form.phoneNumber) || !isValidPhoneFormat(form.phoneNumber))
                                   ? 'border-red-400 dark:border-red-500'
                                   : 'border-gray-300 dark:border-gray-600'"/>
                        <div *ngIf="phoneNumber.touched && form.phoneNumber" class="mt-1.5 space-y-0.5">
                            <p *ngIf="!isInputSafe(form.phoneNumber)"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Contains invalid characters
                            </p>
                            <p *ngIf="isInputSafe(form.phoneNumber) && !isValidPhoneFormat(form.phoneNumber)"
                               class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Invalid format — try +261341234567
                            </p>
                        </div>
                    </div>

                    <!-- Bio -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1.5">Bio</label>
                        <input #description="ngModel"
                               type="text"
                               [(ngModel)]="form.description"
                               (ngModelChange)="updateFormInvalid()"
                               name="description"
                               placeholder="A short description about you"
                               class="w-full px-4 py-3 rounded-xl border text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all"
                               [ngClass]="description.touched && form.description && !isValidBio(form.description)
                                   ? 'border-red-400 dark:border-red-500'
                                   : 'border-gray-300 dark:border-gray-600'"/>
                        <div *ngIf="description.touched && form.description && !isValidBio(form.description)" class="mt-1.5">
                            <p class="text-xs text-red-500 flex items-center gap-1">
                                <svg class="w-3 h-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                At least 3 characters, no excessive repetition
                            </p>
                        </div>
                    </div>
                </div>

            </form>
        </div>

        <!-- Footer -->
        <div class="flex-shrink-0 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 flex items-center justify-end gap-3">
            <app-button size="sm" variant="outline" (btnClick)="closeModal()">Cancel</app-button>
            <app-button size="sm" [loading]="isLoading" [disabled]="formInvalid" (btnClick)="handleSave()">Save Changes</app-button>
        </div>
    </div>
</div>